import{r as l,j as e,L as F,T as p}from"./index-DswFmZ-Y.js";import{f as T,v as C,c as V}from"./authService-0LxlxTZf.js";import{P as L}from"./PasswordInput-oHRPq0hn.js";import"./axios-upsvKRUO.js";const D=({length:t=6,value:f="",onChange:g,disabled:w=!1})=>{const n=l.useRef([]);l.useEffect(()=>{n.current=n.current.slice(0,t)},[t]);const v=(o,s)=>{o.key==="Backspace"&&!o.target.value&&s>0&&n.current[s-1].focus()},j=(o,s)=>{const r=o.target.value;if(r.length>1||!/^\d*$/.test(r))return;const b=f.split("");b[s]=r,g(b.join("")),r&&s<t-1&&n.current[s+1].focus()},k=o=>{var b;o.preventDefault();const s=o.clipboardData.getData("text").slice(0,t);if(!/^\d*$/.test(s))return;g(s.padEnd(t,""));const r=s.length;r<t&&((b=n.current[r])==null||b.focus())};return e.jsx("div",{className:"flex gap-x-3",children:Array(t).fill(0).map((o,s)=>e.jsx("input",{type:"text",ref:r=>n.current[s]=r,className:"block w-[38px] h-[38px] text-center border border-gray-200 rounded-md text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400 dark:focus:ring-gray-600",maxLength:1,placeholder:"âš¬",value:f[s]||"",onChange:r=>j(r,s),onKeyDown:r=>v(r,s),onPaste:k,disabled:w},s))})},i={EMAIL:"email",VERIFY:"verify",RESET:"reset"},q=()=>{const[t,f]=l.useState(i.EMAIL),[g,w]=l.useState(""),[n,v]=l.useState(""),[j,k]=l.useState(""),[o,s]=l.useState(""),[r,b]=l.useState(""),[c,h]=l.useState(!1),[E,y]=l.useState(""),S=async u=>{var m,x;u.preventDefault(),y(""),h(!0);try{const d=await T(g);if(d.status==="success"&&d.resetId)k(d.resetId),p.success("Reset code has been sent to your email"),f(i.VERIFY);else throw new Error("Invalid response from server")}catch(d){const a=((x=(m=d.response)==null?void 0:m.data)==null?void 0:x.message)||"Failed to process request";p.error(a),y(a)}finally{h(!1)}},P=async u=>{var m,x,d;if(u.preventDefault(),n.length!==6){p.error("Please enter a valid 6-digit code");return}y(""),h(!0);try{const a=await C(j,n);if(a.status==="success"&&((m=a.data)!=null&&m.resetToken))b(a.data.resetToken),p.success("Code verified successfully"),f(i.RESET);else throw new Error("Invalid verification response")}catch(a){console.error("Verification Error:",a);const N=((d=(x=a.response)==null?void 0:x.data)==null?void 0:d.message)||"Invalid verification code";p.error(N),y(N)}finally{h(!1)}},R=async u=>{var m,x;u.preventDefault(),y(""),h(!0);try{await V(r,o),p.success("Password reset successful! Please login with your new password"),setTimeout(()=>{window.location.href="/login"},2e3)}catch(d){const a=((x=(m=d.response)==null?void 0:m.data)==null?void 0:x.message)||"Failed to reset password";p.error(a),y(a)}finally{h(!1)}},I=()=>{switch(t){case i.EMAIL:return e.jsx("form",{onSubmit:S,children:e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm mb-2 dark:text-white",children:"Email address"}),e.jsx("input",{type:"email",id:"email",className:"py-3 px-4 block w-full border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-gray-900 dark:border-gray-700 dark:text-gray-400",required:!0,value:g,onChange:u=>w(u.target.value),disabled:c})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none dark:focus:ring-offset-gray-800",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin inline-block size-4 border-[2px] border-current border-t-transparent text-white rounded-full"}),"Sending..."]}):"Send Reset Code"})]})});case i.VERIFY:return e.jsx("form",{onSubmit:P,children:e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-2 dark:text-white",children:"Enter verification code"}),e.jsx("div",{className:"mt-2",children:e.jsx(D,{length:6,value:n,onChange:v,disabled:c})}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["We sent a code to ",g]})]}),e.jsx("button",{type:"submit",disabled:c||n.length!==6,className:"w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none dark:focus:ring-offset-gray-800",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin inline-block size-4 border-[2px] border-current border-t-transparent text-white rounded-full"}),"Verifying..."]}):"Verify Code"}),e.jsx("button",{type:"button",onClick:()=>f(i.EMAIL),className:"w-full py-2 px-3 inline-flex justify-center items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-700",children:"Back to Email"})]})});case i.RESET:return e.jsx("form",{onSubmit:R,children:e.jsxs("div",{className:"grid gap-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"newPassword",className:"block text-sm mb-2 dark:text-white",children:"New Password"}),e.jsx(L,{value:o,onChange:u=>s(u.target.value),disabled:c,showHints:!0})]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full py-3 px-4 inline-flex justify-center items-center gap-x-2 text-sm font-semibold rounded-lg border border-transparent bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50 disabled:pointer-events-none dark:focus:ring-offset-gray-800",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin inline-block size-4 border-[2px] border-current border-t-transparent text-white rounded-full"}),"Resetting..."]}):"Reset Password"})]})})}};return e.jsx("div",{className:"max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto",children:e.jsx("div",{className:"mt-7 border border-gray-200 rounded-xl shadow-sm dark:border-gray-700 max-w-md mx-auto",children:e.jsxs("div",{className:"p-4 sm:p-7",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"block text-2xl font-bold text-gray-800 dark:text-white",children:[t===i.EMAIL&&"Forgot Password",t===i.VERIFY&&"Verify Code",t===i.RESET&&"Reset Password"]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:["Remember your password?",e.jsx(F,{to:"/login",className:"ml-1 text-blue-600 decoration-2 hover:underline font-medium dark:text-blue-500",children:"Sign in here"})]})]}),e.jsxs("div",{className:"mt-5",children:[E&&e.jsx("div",{className:"text-sm text-red-600 dark:text-red-500 mb-4",children:E}),I()]})]})})})};export{q as default};
